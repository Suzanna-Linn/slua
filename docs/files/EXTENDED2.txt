
local TABLE_TYPES = { ARRAY = 1, DICT = 2, MIX = 3 }

function xTable(data)

  local fn = {
      
    length = function(t)
      local count = 0
      for _ in pairs(t) do
        count = count + 1
      end
      return count
    end,
    
    tableType = function(t)
      local arrayLen = #t
      local dictLen = t:length()
      if arrayLen == dictLen then
        return TABLE_TYPES.ARRAY
      elseif arrayLen == 0 then
        return TABLE_TYPES.DICT
      else
        return TABLE_TYPES.MIX
      end
    end
    
  }
  
  local mt = {
      
    __index = function(t,k)
      if fn[k] then
        return fn[k]
      else
        return table[k]
      end
    end
    
  }
  
  return setmetatable(data, mt)
end

fruits = xTable{ "apple", "banana", "lemon", "orange" }

fruits.insert(fruits, "pear")
fruits:insert("melon")

print(fruits:length())  -- 6
print(fruits:tableType())  -- 1

fruits["key111"] = 111

print(fruits:length())  -- 7
print(fruits:tableType())  -- 3
